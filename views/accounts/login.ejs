<% include ../header.ejs %>

    <section id="login" class="bg-on navbar-fixed-top">
    </section>

    <div class="container" id="login_page">
        <%if(typeof flashMessage !=='undefined') {%>
                <div class="alert alert-danger" role="alert"><%=flashMessage%></div>
        <%}%>
        <div class="panel login-panel test">
            <div class="test-heading">
                <div class="logo">
                    <img src="/public/img/login-logo.png">
                </div>
            </div>
            <div class="form-inputs with-icons">
                <form role="form" action="" id="login_form" method="post">
                    <fieldset>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user "></i></span>
                            <input class="form-control" placeholder="<%= language.login.inputId%>" id="userid" name="userid" type="text" autofocus=""/>
                            <input type="hidden" id="hidden_userid" value="<%=userid%>">
                        </div>

                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                            <input class="form-control" placeholder="<%= language.login.inputPassword%>" name="password" type="password" value="" />
                        </div>
                        <% if( flashMessage == language.login.notEmailCheckMessage ) {%>
                            <a id="resend" class="btn btn-lg btn-link btn-block"><span id="resendval"></span></a>
                        <% } else if( flashMessage == language.login.dormancyMessage ) { %>
                            <input type="button" id="dormancy_verification" class="btn btn-lg btn-link btn-block" value="<%= language.login.release%>" />
                        <% } %>                                           
                        <br>

                        <input type="submit" class="btn btn-lg btn-block loginbutton" value="<%= language.login.loginButton%>">
                        <br>
                    
                        <div class="row saveid">
                        <input type="checkbox" id="idSaveCheck">
                                <label for="idSaveCheck" style="float:left;"><%= language.login.idSaveCheck%></label></div>

                        <div class="row joinwithpass">
                            <div class="col-md-6">
                                <a href="/accounts/join"><%= language.login.joinButton%></a> 
                            </div>
                            <div class="col-md-6" id="findPasswordDiv">
                                <a href="/accounts/resetPasswordMail"><span id="serchPassword"></span></a>  
                            </div>
                        </div>
                        <!-- 소셜 로그인 !-->
                        <!--
                        <div style="margin-top: 20px">
                            <a class="btn btn-block btn-social btn-lg btn-facebook" href="/auth/facebook">
                            <span class="fa fa-facebook"></span> Login with Facebook
                            </a>
                        </div>
                        <div style="margin-top: 20px">
                            <a class="btn btn-block btn-social btn-lg btn-google" href="/auth2/google">
                            <span class="fa fa-google"></span> Login with google
                            </a>
                        </div>
                        <div style="margin-top: 20px">
                            <a class="btn btn-block btn-social btn-lg btn-github" href="/auth3/github">
                            <span class="fa fa-github"></span> Login with github
                            </a>
                        </div>       
                        !--> 
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
<!-- </section> -->

<script type="text/javascript">
(function(){
    $(document).ready(function() {

        // 다국어안에 포함된 html (<>)태그 치환
        var value = "<%= language.login.sendEmailAgain%>";
        var searchPassword = "<%=language.login.serchPassword%>";

        var str = value.replace(/&lt;/g, '<').replace(/&gt;/g, '>');
        var str_searchPassword =searchPassword.replace(/&lt;/g, '<').replace(/&gt;/g, '>');

        $("#resendval").html(str);
        $("#serchPassword").html(str_searchPassword);

        // 저장된 쿠키값을 가져와서 ID 칸에 넣어준다. 없으면 공백으로 들어감.
        var userInput = getCookie("userInput");
        $("input[name=userid]").val(userInput);
        if($("input[name=userid]").val() != ""){ // 그전에 ID를 저장해서 처음 페이지 로딩 시, 입력 칸에 저장된 ID가 표시된 상태라면,
            $("#idSaveCheck").attr("checked", true); // ID 저장하기 체크박스 체크 상태로 두기
        }
        $("#idSaveCheck").change(function(){ // 체크박스에 변화가 있을 시
            if($("#idSaveCheck").is(":checked")) { // ID 저장하기 체크했을 시 
                var userInput = $("input[name=userid]").val();
                setCookie("userInput", userInput, 7); // 7일 동안 쿠키 보관
            } else { // ID 저장하기 체크 해제 시
                deleteCookie("userInput");
            }
        });
        // ID 저장하기를 체크한 상태에서 ID 입력하는 경우 이럴때도 쿠키 저장
        $("input[name=userid]").blur(function(){   // ID 입력 칸에 ID 입력할 때
            if($("#idSaveCheck").is(":checked")) { // ID 저장하기를 체크한 상태라면,
                var userInput = $("input[name=userid]").val();
                setCookie("userInput", userInput, 7); // 7일 동안 쿠키 보관
            }
        });

        $('#login_form').submit(function(){
            var $useridInput = $('#login_form input[name=userid]');
            var $passwordInput = $('#login_form input[name=password]');    
            if(!$useridInput.val()){
                alert("<%= language.login.inputMessge_1%>");
                $useridInput.focus();
                return false;
            }
            if(!$passwordInput.val()){
                alert("<%= language.login.inputMessge_2%>");
                $passwordInput.focus();
                return false;
            }
            return true;
        });
        
        // 이메일 재전송 버튼 클릭
        $('#resend').click(function(){
            var userid = $('#hidden_userid').val();
            console.log(userid);
            if(userid){
            $.ajax({
                url : '/accounts/resendVerification/'+userid.trim(),
                type : 'GET'
            })
            .success(function(args) {                
                if(args){
                    console.log(args);
                    document.location.href = '/accounts/resendVerificationEmail';
                }
            })
            .fail(function(args) {
                console.log(args);
            });
            }
        });

        $('#dormancy_verification').click(function() {
            location.href = '/accounts/releaseDormancyAccount';
        });
    });
})();

function setCookie(cookieName, value, exdays) {
    var exdate = new Date();
    exdate.setDate(exdate.getDate() + exdays);
    var cookieValue = escape(value) + ((exdays==null) ? "" : "; expires=" + exdate.toGMTString());
    document.cookie = cookieName + "=" + cookieValue;
}
function deleteCookie(cookieName) {
    var expireDate = new Date();
    expireDate.setDate(expireDate.getDate() - 1);
    document.cookie = cookieName + "= " + "; expires=" + expireDate.toGMTString();
}
function getCookie(cookieName) {
    cookieName = cookieName + '=';
    var cookieData = document.cookie;
    var start = cookieData.indexOf(cookieName);
    var cookieValue = '';
    if(start != -1){
        start += cookieName.length;
        var end = cookieData.indexOf(';', start);
        if(end == -1)end = cookieData.length;
        cookieValue = cookieData.substring(start, end);
    }
    return unescape(cookieValue);
}


</script>
<% include ../footer.ejs %>