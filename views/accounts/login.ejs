<% include ../header.ejs %>
<div class="row">
    <div class="col-md-4 col-md-offset-4">
    <%if(typeof flashMessage !=='undefined') {%>
            <div class="alert alert-danger" role="alert"><%=flashMessage%></div>
    <%}%>
        <div class="login-panel panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">로그인</h3>
            </div>
            <div class="panel-body">
                <form role="form" action="" id="login_form" method="post">
                    <fieldset>
                        <div class="form-group">
                            <input class="form-control" placeholder="ID" id="userid" name="userid" type="text" autofocus="" required="" />
                            <input type="hidden" id="hidden_userid" value="<%=userid%>">
                        </div>
                        <div class="form-group">
                            <input class="form-control" placeholder="Password" name="password" type="password" value="" required="">
                        </div>                 
                        <%if( flashMessage == '이메일 인증이 안된 회원입니다.') {%>
                            <input type="button" id="resend" class="btn btn-lg btn-link btn-block" value="인증메일 재전송을 원하시면 클릭">
                        <%}%>                                                
                        <br>
                        <br>
                        <input type="submit" class="btn btn-lg btn-success btn-block" value="Login">
                        <br>
                        <a href="/accounts/resetPasswordMail">비밀번호 재설정</a>  
                        <br>
                        <!-- 소셜 로그인 !-->
                        <div style="margin-top: 20px">
                             <a class="btn btn-block btn-social btn-lg btn-facebook" href="/auth/facebook">
                              <span class="fa fa-facebook"></span> Login with Facebook
                            </a>
                        </div>
                        <div style="margin-top: 20px">
                             <a class="btn btn-block btn-social btn-lg btn-google" href="/auth2/google">
                              <span class="fa fa-google"></span> Login with google
                            </a>
                        </div>
                        <div style="margin-top: 20px">
                             <a class="btn btn-block btn-social btn-lg btn-github" href="/auth3/github">
                              <span class="fa fa-github"></span> Login with github
                            </a>
                        </div>        
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
(function(){
    $(document).ready(function() {
        $('#login_form').submit(function(){
            var $useridInput = $('#login_form input[name=userid]');
            var $passwordInput = $('#login_form input[name=password]');    
            if(!$useridInput.val()){
                alert("아이디를 입력해주세요.");
                $useridInput.focus();
                return false;
            }
            if(!$passwordInput.val()){
                alert("패스워드를 입력해주세요.");
                $passwordInput.focus();
                return false;
            }
            return true;
        });
        
        // 이메일 재전송 버튼 클릭
        $('#resend').click(function(){
            var userid = $('#hidden_userid').val();
            console.log(userid);
            if(userid){
            $.ajax({
                url : '/accounts/reverify/'+userid.trim(),
                type : 'GET'
            })
            .success(function(args) {                
                if(args){
                    console.log(args);
                    document.location.href = '/accounts/resendEmail';
                }
            })
            .fail(function(args) {
                console.log(args);
            });
            }
        });
    });
})();

</script>
<% include ../footer.ejs %>